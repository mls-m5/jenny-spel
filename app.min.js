/// <reference path="jquery.d.ts" />
/// <reference path="player.ts" />
/// <reference path="enemies.ts" />
/// <reference path="game.ts" />
/// <reference path="main.ts" />
/// <reference path="enemies.ts" />
/// <reference path="player.ts" />
/// <reference path="menu.ts" />
/// <reference path="main.ts" />
/// <reference path="game.ts" />
/// <reference path="main.ts" />
/// <reference path="main.ts" />
/// <reference path="player.ts" />
var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])
t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),keyCodes=Object.freeze({left:37,right:39,space:32}),Ground=function(){function t(t,i){this.x=t,this.y=i,this.img=document.getElementById("ground1"),this.imgWidth=this.img.width,this.imgHeight=this.img.height,this.alive=!0,this.width=200,this.height=100}return t.prototype.draw=function(){ctx.save(),ctx.translate(this.x,-this.y+game.height),ctx.drawImage(this.img,0,0,this.width,this.height),ctx.restore()},t.prototype.findVertical=function(t,i){return t<this.x+this.width&&t>this.x&&i>this.y-this.height?this.y-i:null},t.prototype.step=function(){this.x-=game.scrollSpeed,this.x<-this.width&&(this.alive=!1)},t}(),Unit=function(){function t(){this.alive=!0}return t.prototype.step=function(){},t.prototype.draw=function(){},t}(),Smoke=function(t){function i(i,e){t.call(this),this.x=i,this.y=e,this.imgs=[],this.imgIndex=0,this.time=0,this.size=50
for(var s=1;s<=7;++s)this.imgs[s]=document.getElementById("smoke"+s)
this.img=this.imgs[1]}return __extends(i,t),i.prototype.draw=function(){ctx.save(),ctx.translate(this.x,game.height-this.y),ctx.drawImage(this.img,-this.size/2,-this.size/2,this.size,this.size),ctx.restore()},i.prototype.step=function(){++this.time,this.imgIndex=Math.floor(this.time/2)+1,this.imgIndex>7&&(this.imgIndex=7,this.alive=!1),this.img=this.imgs[this.imgIndex]},i}(Unit),Blood=function(t){function i(i,e){t.call(this),this.x=i,this.y=e,this.imgs=[],this.imgIndex=0,this.size=200,this.opacity=1,this.img=document.getElementById("blood"+Math.floor(2.99*Math.random()+1))}return __extends(i,t),i.prototype.draw=function(){this.opacity<=0||(ctx.save(),ctx.translate(this.x,game.height-this.y),ctx.globalAlpha=this.opacity,ctx.drawImage(this.img,-this.size/2,-this.size/2,this.size,this.size),ctx.globalAlpha=1,ctx.restore())},i.prototype.step=function(){this.opacity<=0?this.alive=!1:this.opacity-=.08},i}(Unit),Sounds=function(){function t(){this.ouch=this.loadAll("ouch"),this.snap=this.loadAll("snap"),this.gr=this.loadAll("gr"),this.splash=this.loadAll("splash"),this.hish=this.loadAll("pys"),this.punch=this.loadAll("punch"),this.steps=this.loadAll("steps"),this.lava=this.loadAll("lava")}return t.prototype.loadAll=function(t){for(var i=1,e=null,s=[];null!=(e=document.getElementById(t+i));)s[i-1]=e,++i
return s},t.prototype.playsound=function(t){var i=this[t],e=i[Math.floor(i.length*Math.random())]
e.paused?e.play():e.currentTime=0},t}(),Level=function(){function t(){this.tyranosaurus=!1,this.lava=!0,this.scrollSpeed=4,this.meteors=!1,this.liaoningopterus=!1,this.enemyMultiplier=2,this.length=500,this.house=!1,this.lastLevel=!1,this.text=""}return t}(),Level1=function(t){function i(){t.apply(this,arguments),this.text="Hej! Och välkommen på kalas! Förresten se upp för lavan i trädgården den kan vara lite varm så här dags"}return __extends(i,t),i}(Level),Level2=function(t){function i(){t.apply(this,arguments),this.scrollSpeed=7,this.tyranosaurus=!0,this.length=1e3,this.text="Oj! Jag glömde att berätta, jag släppte ut Dino idag, han kan gilla att leka, säkert inget farligt, ehe"}return __extends(i,t),i}(Level1),Level3=function(t){function i(){t.apply(this,arguments),this.liaoningopterus=!0,this.lava=!1,this.text="Just tusan, mina flygödlor har smitit..."}return __extends(i,t),i}(Level2),Level4=function(t){function i(){t.apply(this,arguments),this.meteors=!0,this.text="Typiskt, just när man har samlat ihop ett gäng fina dinosaurier så blir det meteoritregn..."}return __extends(i,t),i}(Level3),Level5=function(t){function i(){t.apply(this,arguments),this.lava=!0,this.text="Hej! Hur går det? Vi börjar snart med maten"}return __extends(i,t),i}(Level4),Level6=function(t){function i(){t.apply(this,arguments),this.enemyMultiplier=5,this.text="Jag kan se dig härifrån, det är bara en bit till"}return __extends(i,t),i}(Level5),Level7=function(t){function i(){t.apply(this,arguments),this.tyranosaurus=!1,this.lava=!1,this.scrollSpeed=4,this.meteors=!1,this.liaoningopterus=!1,this.enemyMultiplier=2,this.length=500,this.house=!0,this.lastLevel=!0,this.text="Välkommen, du han precis i tid :)"}return __extends(i,t),i}(Level6),levels=[new Level1,new Level2,new Level3,new Level4,new Level5,new Level6,new Level7],House=function(t){function i(i){t.call(this),this.x=i,this.y=0,this.img=document.getElementById("hus"),this.width=this.img.width/2,this.height=this.img.height/2}return __extends(i,t),i.prototype.draw=function(){ctx.save(),ctx.translate(this.x,-this.y+game.height),ctx.drawImage(this.img,0,-this.height,this.width,this.height),ctx.restore()},i.prototype.step=function(){this.x-=game.scrollSpeed,this.x<100&&(game.scrollSpeed/=1.1)},i}(Unit),Display=function(){function t(){}return t.prototype.step=function(){},t.prototype.draw=function(){},t}(),game,sounds,menu
$(document).ready(function(){menu=new Menu,sounds=new Sounds,setInterval(function(){game&&(game.step(),game.draw()),menu.draw()},50),$(document).keydown(function(t){game?t.keyCode!=keyCodes.left&&t.keyCode!=keyCodes.right&&t.keyCode!=keyCodes.space||(game.keyPress(t.keyCode),t.preventDefault()):menu.keyPress(t.keyCode)}),$(document).keyup(function(t){game&&game.keyup(t.keyCode)})})
var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])
t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Mobile=function(){function t(){this.imgs=[document.getElementById("mobil1"),document.getElementById("mobil2"),document.getElementById("mobil3"),document.getElementById("mobil4")],this.indexMap=[0,1,2,1,3,1],this.width=this.imgs[0].width/5,this.height=this.imgs[0].height/5,this.index=0,this.nextIndex=0,this.mobileText="",this.show=200,this.opacity=1}return t.prototype.showText=function(t){this.mobileText=t,this.show=200},t.prototype.draw=function(){--this.nextIndex<=0&&(this.nextIndex=2,++this.index>=this.indexMap.length&&(this.index=0)),this.opacity>0&&(ctx.globalAlpha=.8*this.opacity,ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,game.width,50),ctx.globalAlpha=this.opacity,ctx.strokeStyle="Black",ctx.drawImage(this.imgs[this.indexMap[this.index]],0,0,this.width,this.height),ctx.font="12px sans-serif",ctx.strokeText(this.mobileText,this.width+10,30),ctx.globalAlpha=1)},t.prototype.step=function(){this.show>0?(--this.show,this.opacity=1):(this.show=0,this.opacity>0?this.opacity-=.1:this.opacity=0)},t}(),Grass=function(){function t(){this.img=document.getElementById("grass"),this.x=0,this.y=25,this.width=this.img.width,this.height=this.img.height}return t.prototype.step=function(){this.x-=game.scrollSpeed,this.x<-this.width&&(this.x+=this.width)},t.prototype.draw=function(){var t=Math.ceil(game.width/this.width)+1
ctx.save(),ctx.translate(this.x,game.height-this.y)
for(var i=0;i<t;++i)ctx.drawImage(this.img,+this.width*i,0,this.width,this.height)
ctx.restore()},t}(),LifeMeter=function(){function t(){this.img=document.getElementById("egg"),this.x=10,this.y=40,this.width=30,this.height=this.width}return t.prototype.draw=function(){var t=game.player.lives
ctx.save(),ctx.translate(this.x,game.height-this.y)
for(var i=0;i<t;++i)ctx.drawImage(this.img,+this.width*i,0,this.width,this.height)
ctx.restore()},t}(),Game=function(t){function i(){for(t.call(this),this.width=canvas.width,this.height=canvas.height,this.player=new Player,this.dino=new Tyranosaurus,this.ground=[],this.lava=new Lava,this.units=[],this.nextMeteor=0,this.nextDino=0,this.scrollSpeed=7,this.mobile=new Mobile,this.grass=new Grass,this.lifeMeter=new LifeMeter,this.dead_title=document.getElementById("dead_title"),this.level=-1,this.overlay=1,this.finishLevel();this.checkGround(););}return __extends(i,t),i.prototype.checkGround=function(){if(this.currentLevel.lava){if(0==this.ground.length||this.ground[this.ground.length-1].x<this.width){var t=this.width
return this.ground.length>0&&(t=this.ground[this.ground.length-1].x+300),this.ground.push(new Ground(t,200*Math.random()+80)),!0}return!1}return!1},i.prototype.push=function(t){this.units.push(t)},i.prototype.pushFront=function(t){this.units.unshift(t)},i.prototype.step=function(){this.checkGround(),this.gameLogics()
for(var t=0,i=this.ground;t<i.length;t++){var e=i[t]
e.step()}this.house&&(this.house.step(),(this.house.alive=!1)&&(this.house=null)),this.ground=this.ground.filter(function(t){return t.alive}),this.player.step(),this.dino&&this.dino.step(),this.lava&&this.lava.step(),this.grass&&this.grass.step()
for(var s=0,h=this.units;s<h.length;s++){var n=h[s]
n.step()}this.mobile.step(),this.units=this.units.filter(function(t){return t.alive})},i.prototype.draw=function(){ctx.clearRect(0,0,this.width,this.height),this.grass.draw(),this.house&&this.house.draw()
for(var t=0,i=this.ground;t<i.length;t++){var e=i[t]
e.draw()}this.player.draw(),this.dino&&this.dino.draw(),this.lava.draw()
for(var s=0,h=this.units;s<h.length;s++){var n=h[s]
n.draw()}this.lifeMeter.draw(),this.mobile.draw(),this.overlay&&(ctx.globalAlpha=this.overlay,ctx.fillStyle="black",ctx.fillRect(0,0,this.width,this.height),ctx.globalAlpha=1,!this.currentLevel.lastLevel&&this.player.lives<=0&&ctx.drawImage(this.dead_title,0,0,this.width,this.height))},i.prototype.finishLevel=function(){this.currentLevel&&this.currentLevel.lastLevel||(++this.level,this.currentLevel=levels[this.level],this.dino.hide||this.currentLevel.tyranosaurus||sounds.playsound("gr"),this.dino.hide=!this.currentLevel.tyranosaurus,this.nextMeteor=100,this.nextDino=100,this.leftOnLevel=this.currentLevel.length,this.scrollSpeed=this.currentLevel.scrollSpeed,this.lava.hide=!this.currentLevel.lava,this.currentLevel.house&&(this.house=new House(2*this.width)),this.mobile.showText(this.currentLevel.text))},i.prototype.gameLogics=function(){this.currentLevel.meteors&&--this.nextMeteor<0&&(this.nextMeteor=(50+50*Math.random())/this.currentLevel.enemyMultiplier,this.push(new Meteor(Math.random()*this.width,this.height+100,20*Math.random()-10))),this.currentLevel.liaoningopterus&&--this.nextDino<0&&(this.nextDino=(70+60*Math.random())/this.currentLevel.enemyMultiplier,this.push(new Liaoningopterus(300*Math.random()+this.width,30*Math.random()+this.height,Math.random()))),--this.leftOnLevel,this.leftOnLevel<0&&this.finishLevel(),this.currentLevel.lastLevel?this.leftOnLevel<=0&&this.overlay<1&&(this.overlay+=.01,this.overlay=Math.min(1,this.overlay),this.overlay>=1&&(game=null)):this.player.lives<=0?(this.overlay+=.02,this.overlay=Math.min(1,this.overlay),this.overlay>=1&&(game=null)):this.overlay>0&&(this.overlay-=.01,this.overlay=Math.max(0,this.overlay))},i.prototype.keyPress=function(t){this.player.keyPress(t)},i.prototype.keyup=function(t){this.player.keyup(t)},i.prototype.findVertical=function(t,i){for(var e=null,s=0,h=this.ground;s<h.length;s++){var n=h[s],o=n.findVertical(t,i)
null!=o&&o>=e&&(e=o)}return e},i}(Display),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])
t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Menu=function(t){function i(){t.apply(this,arguments),this.width=canvas.width,this.height=canvas.height,this.titleImg=document.getElementById("title"),this.playImage=document.getElementById("play"),this.titleWidth=this.titleImg.width,this.titleHeight=this.titleImg.height}return __extends(i,t),i.prototype.draw=function(){game||(ctx.fillStyle="black",ctx.fillRect(0,0,this.width,this.height),ctx.drawImage(this.titleImg,this.width/2-150,150),ctx.drawImage(this.playImage,this.width/2-100,300))},i.prototype.keyPress=function(t){game||(game=new Game)},i}(Display),Player=function(){function t(){this.x=300,this.y=0,this.vy=0,this.pillis=document.getElementById("pillis"),this.width=100,this.height=100,this.hitWidth=.7*this.width,this.hitHeight=.7*this.height,this.lastDir=0,this.onGround=!1,this.invincible=0,this.visible=!0,this.lives=10}return t.prototype.draw=function(){this.invincible>0?this.visible=!this.visible:this.visible=!0,this.visible&&(ctx.save(),ctx.translate(this.x,-this.y+game.height-this.height/2),this.onGround&&ctx.rotate(Math.random()/4),ctx.drawImage(this.pillis,-this.width/2,-this.height/2,this.width,this.height),ctx.restore())},t.prototype.isHit=function(t,i){return t>this.x-this.hitWidth/2&&t<this.x+this.hitWidth/2&&i>this.y&&i<this.y+this.hitHeight},t.prototype.damage=function(){return!(this.invincible>0)&&(game.push(new Blood(this.x,this.y)),this.invincible=50,sounds.playsound("ouch"),sounds.playsound("splash"),this.lives-=1,!0)},t.prototype.step=function(){this.onGround=!1,this.x-=1,this.x>0&&(this.x+=10*this.lastDir),this.x<200&&(this.x=200),this.x>game.width&&(this.x=game.width),this.y+=this.vy,this.vy-=4,this.y<=0&&(this.y=0,this.onGround=!0,this.vy<0&&(this.vy=0))
var t=game.findVertical(this.x,this.y)
null!==t&&(this.y+=t,this.vy<0&&(this.vy=0),this.onGround=!0),this.invincible>0&&--this.invincible},t.prototype.jump=function(){this.vy=40},t.prototype.keyPress=function(t){if(console.log(t),t==keyCodes.left||t==keyCodes.right){var i=void 0
i=t==keyCodes.left?-1:1,this.lastDir=i}t==keyCodes.space&&this.onGround&&this.jump()},t.prototype.keyup=function(t){t==keyCodes.left?this.lastDir==-1&&(this.lastDir=0):t==keyCodes.right&&1==this.lastDir&&(this.lastDir=0)},t}(),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])
t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Tyranosaurus=function(){function t(){this.x=-400,this.y=0,this.angular=0,this.img1=document.getElementById("dino"),this.img2=document.getElementById("dino-bite"),this.img=this.img1,this.hide=!0,this.width=400,this.height=400,this.biteToggle=!1,this.biteTime=0,this.nextGr=0}return t.prototype.draw=function(){this.biteToggle?this.img=this.img2:this.img=this.img1
var t=Math.sin(this.angular)/4
if(game.player.x<300){var i=Math.atan2(this.x-game.player.x,this.y+this.height/2-game.player.y)+.6*Math.PI,e=(game.player.x-250)/50
e<0&&(e=0),t=t*e+i*(1-e)}ctx.save(),ctx.translate(this.x+100,20*Math.cos(this.angular)-this.y+game.height-.4*this.height+10*Math.random()),ctx.rotate(t),ctx.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height),ctx.restore()},t.prototype.step=function(){this.angular+=.5,this.angular>2*Math.PI&&(this.angular-=2*Math.PI,this.hide||sounds.playsound("steps")),this.hide?this.x>-400&&(this.x-=game.scrollSpeed):(this.x<0&&(this.x+=10),game.player.x-this.x<270?(++this.biteTime>4&&(this.biteTime=0,sounds.playsound("snap")),this.biteToggle=this.biteTime>2,game.player.damage()):(this.biteToggle=!1,--this.nextGr<=0&&(this.nextGr=100+100*Math.random(),sounds.playsound("gr"))))},t}(),Liaoningopterus=function(t){function i(i,e,s){t.call(this),this.x=i,this.y=e,this.angle=s,this.img=document.getElementById("flygdino"),this.size=200,this.angleChange=1}return __extends(i,t),i.prototype.step=function(){this.x-=10*Math.sin(this.angle),this.y-=10*Math.cos(this.angle),this.angleChange/=1.01,this.angle+=.01*this.angleChange,(this.y<-this.size||this.x<-this.size)&&(this.alive=!1),game.player.isHit(this.x,this.y)&&game.player.damage()&&(this.alive=!1,sounds.playsound("punch"))},i.prototype.draw=function(){ctx.save(),ctx.translate(this.x,game.height-this.y),ctx.rotate(this.angle),ctx.drawImage(this.img,.8*-this.size,.9*-this.size,this.size,this.size),ctx.restore()},i}(Unit),Meteor=function(t){function i(i,e,s){t.call(this),this.x=i,this.y=e,this.vx=s,this.img=document.getElementById("meteor"),this.img2=document.getElementById("meteor_tail"),this.size=50,this.nextSmoke=0,this.tailAngle=0,this.stoneAngle=0,this.stoneAngleVelocity=0,this.vy=-10,this.tailAngle=Math.atan2(this.vx,this.vy)+Math.PI,this.stoneAngleVelocity=Math.random()-.5}return __extends(i,t),i.prototype.destroy=function(){this.alive=!1
var t=new Smoke(this.x+10*Math.random()-5,this.y+10*Math.random()-5)
t.size*=3,game.push(t),this.x>0&&this.x<game.width&&sounds.playsound("punch")},i.prototype.step=function(){--this.nextSmoke<=0&&(this.nextSmoke=3+2*Math.random(),game.pushFront(new Smoke(this.x+10*Math.random()-5,this.y+10*Math.random()-5))),this.y<0&&this.destroy(),game.player.isHit(this.x,this.y)&&game.player.damage()&&this.destroy(),this.x+=this.vx,this.y+=this.vy,this.stoneAngle+=this.stoneAngleVelocity},i.prototype.draw=function(){ctx.save(),ctx.translate(this.x,game.height-this.y),ctx.save(),ctx.rotate(this.tailAngle),ctx.drawImage(this.img2,-this.size,1.5*-this.size,2*this.size,2*this.size),ctx.restore(),ctx.rotate(this.stoneAngle),ctx.drawImage(this.img,-this.size/2,-this.size/2,this.size,this.size),ctx.restore()},i}(Unit),Lava=function(){function t(){this.img=document.getElementById("lava"),this.x=0,this.y=-50,this.width=200,this.height=50,this.nextSmoke=0,this.hide=!0}return t.prototype.step=function(){this.hide?this.y>-50&&(this.y-=.5):(this.y<50&&(this.y+=.5),--this.nextSmoke<0&&(this.nextSmoke=50,game.push(new Smoke(Math.random()*game.width,40)),sounds.playsound("lava"))),this.x-=game.scrollSpeed,this.x<-this.width&&(this.x+=this.width),game.player.y<this.y-20&&game.player.damage()&&sounds.playsound("hish")},t.prototype.draw=function(){var t=Math.ceil(game.width/this.width)+1
ctx.save(),ctx.translate(this.x,game.height-this.y)
for(var i=0;i<t;++i)ctx.drawImage(this.img,+this.width*i,0,this.width,this.height)
ctx.restore()},t}()
